% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/gap_detection.R
\name{detect_morphospace_gaps}
\alias{detect_morphospace_gaps}
\title{Detect Morphospace Gaps with Uncertainty Quantification}
\usage{
detect_morphospace_gaps(
  pca_scores,
  uncertainty = 0.05,
  grid_resolution = 150,
  monte_carlo_iterations = 100,
  bootstrap_iterations = 200,
  certainty_thresholds = c(0.8, 0.9, 0.95),
  pc_pairs = NULL,
  max_pcs = 4,
  hull_type = "alpha",
  alpha_value = NULL,
  hull_buffer = 0.05,
  use_parallel = FALSE,
  n_cores = NULL,
  uncertainty_type = "gaussian",
  occupancy_method = "radius",
  occupancy_radius = 1.5,
  progress_callback = NULL,
  verbose = TRUE
)
}
\arguments{
\item{pca_scores}{Data frame or matrix with PC scores}

\item{uncertainty}{Proportion of axis range for uncertainty radius}

\item{grid_resolution}{Number of grid cells along each axis}

\item{monte_carlo_iterations}{Number of Monte Carlo replicates}

\item{bootstrap_iterations}{Number of bootstrap resamples}

\item{certainty_thresholds}{Gap certainty thresholds for polygon extraction}

\item{pc_pairs}{Optional matrix specifying PC pairs to analyze}

\item{max_pcs}{Maximum PC to include in automatic pair generation}

\item{hull_type}{Type of hull for domain constraint}

\item{alpha_value}{Alpha parameter for alphahull}

\item{hull_buffer}{Proportional buffer to add around hull}

\item{use_parallel}{Use parallel processing}

\item{n_cores}{Number of cores for parallel processing}

\item{uncertainty_type}{Type of uncertainty model}

\item{occupancy_method}{Method to determine cell occupancy}

\item{occupancy_radius}{Radius for occupancy detection}

\item{progress_callback}{Optional function for progress updates}

\item{verbose}{Print progress messages}
}
\value{
List of class morphospace_gaps with results
}
\description{
Detect Morphospace Gaps with Uncertainty Quantification
}
\details{
The function implements a rigorous two-stage uncertainty analysis:

\strong{Stage 1: Measurement Uncertainty (Monte Carlo)}
Each observed point is treated as uncertain within Â±u (uncertainty * axis range).
For each Monte Carlo iteration, points are perturbed according to the
uncertainty model (Gaussian or uniform). Grid cells are marked as occupied
if any perturbed point falls within the occupancy radius. The gap probability
for each cell is the proportion of iterations where it remains unoccupied.

\strong{Stage 2: Sampling Uncertainty (Bootstrap)}
To assess whether gaps are artifacts of limited sampling, the dataset is
resampled (with replacement) B times. For each resample, the Monte Carlo
procedure is repeated and a binary gap mask is created. The gap stability
for each cell is the proportion of bootstrap iterations where it was
classified as a gap.

\strong{Combined Certainty}
gap_certainty = gap_probability * gap_stability
This represents the probability that a region is genuinely unoccupied,
accounting for both measurement and sampling uncertainty.
}
\examples{
\dontrun{
# Assuming pca_result from PCA() contains $x with PC scores
gaps <- detect_morphospace_gaps(
  pca_scores = pca_result$x,
  uncertainty = 0.05,
  grid_resolution = 150,
  monte_carlo_iterations = 100,
  bootstrap_iterations = 200,
  max_pcs = 3
)

# View summary
print(gaps$summary_table)

# Access results for PC1-PC2
pc1_pc2_gaps <- gaps$results$`PC1-PC2`
plot(pc1_pc2_gaps$gap_certainty)
}

}
